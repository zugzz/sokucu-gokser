let state = {
    mevcut_yil: 2026.0,
    cicekler: [],
    kilitli_nesneler: {
        bilgisayar: true,
        dolap_kutusu: true,
        yatak_kutusu: true,
        koltuk_zarfi: true,
        duvar_saati: true,
    },
    is_mavis_found: false 
};

const DURATION_MONTHS = 0.5; 

const dateDisplayEl = document.getElementById('date-display');
const flowerCountEl = document.getElementById('flower-count');
const dateTextEl = document.getElementById('date-text');
const messageDisplayEl = document.getElementById('message-display');
const rootElement = document.documentElement; 

function updateUI() {
    const ay = state.mevcut_yil % 1 !== 0 ? "Haziran" : "AralÄ±k";
    const yil_gosterim = Math.floor(state.mevcut_yil);
    
    // Ã‡iÃ§ek sayÄ±sÄ±, toplam 6 bulmaca Ã¼zerinden renklenmeyi kontrol eder
    const cozulmus_bulmaca_sayisi = state.cicekler.length;
    
    dateDisplayEl.textContent = `${yil_gosterim}`;
    dateTextEl.textContent = `${yil_gosterim} (${ay})`;
    flowerCountEl.textContent = cozulmus_bulmaca_sayisi;

    // AÅŸamalÄ± Renklenme: Her Ã§Ã¶zÃ¼len bulmaca iÃ§in yaklaÅŸÄ±k %16.6 azalÄ±r.
    const grayscaleValue = 100 - (cozulmus_bulmaca_sayisi * 16.66);
    rootElement.style.setProperty('--grayscale-level', `${Math.max(0, grayscaleValue)}%`);
}

function displayMessage(text) {
    messageDisplayEl.textContent = text;
    messageDisplayEl.style.display = 'block';
    setTimeout(() => { messageDisplayEl.style.display = 'none'; }, 5000);
}

function cozumTamamla(bulmaca_anahtari, cicek_adi, soz, is_surprise = false, is_final = false) {
    if (!is_final) {
        if (bulmaca_anahtari !== "turuncu_kedi") { state.kilitli_nesneler[bulmaca_anahtari] = false; }
        
        state.mevcut_yil -= DURATION_MONTHS; 
        if (!state.cicekler.includes(cicek_adi)) { state.cicekler.push(cicek_adi); }

        alert(`âœ… ${bulmaca_anahtari.toUpperCase().replace('_', ' ')} Ã‡Ã–ZÃœLDÃœ! \nğŸ’ Yeni Ã‡iÃ§ek: ${cicek_adi} \nâ³ Zaman Geri Gitti!`);
        
        if (!is_surprise) {
            displayMessage(`--- [BULUNAN NOT] ---\n"${soz}"`);
        }
        
        if (state.cicekler.length >= 5 && state.kilitli_nesneler["duvar_saati"]) { 
            alert("âœ¨ TÃœM ANA BULMACALAR Ã‡Ã–ZÃœLDÃœ. SIRA DUVAR SAATÄ°NDE!");
        }

    } else {
        // Final Ã‡Ã¶zÃ¼m (Saat)
        state.cicekler.push("Orkide", "MenekÅŸe");
        state.kilitli_nesneler["duvar_saati"] = false;
        
        alert("ğŸ‰ ODA ARTIK TAMAMEN RENKLÄ°! BÃœTÃœN ANILAR CANLANDI!");
        displayMessage(`ğŸ’– [NÄ°HAÄ° NOT] ğŸ’–\n"Sana dair her ÅŸey, kalbimin ezberlediÄŸi en gÃ¼zel ÅŸarkÄ±nÄ±n notalarÄ±."\nHOÅ GELDÄ°N...`);
    }

    updateUI();
}

window.checkPuzzle = function(nesne_adi) {
    
    if (nesne_adi === 'turuncu_kedi' && !state.cicekler.includes("KÄ±rmÄ±zÄ± GÃ¼l")) {
        cozumTamamla("turuncu_kedi", "KÄ±rmÄ±zÄ± GÃ¼l", "", true);
    }
    else if (nesne_adi === 'bilgisayar' && state.kilitli_nesneler.bilgisayar) {
        const sifre = prompt("Bilgisayar ÅŸifresini girin (Ä°pucu: Kedi-Koltuk-Pencere-Yatak sayÄ±larÄ±):");
        if (sifre === "2231") { cozumTamamla("bilgisayar", "Beyaz Zambak", "GÃ¶zlerin, en gri gÃ¼nleri bile aydÄ±nlatan sihirli bir Ä±ÅŸÄ±k."); } 
        else { alert("YanlÄ±ÅŸ ÅŸifre."); }
    }
    else if (nesne_adi === 'dolap' && state.kilitli_nesneler.dolap_kutusu) {
        const sifre = prompt("Dolaptaki kutunun sembol sÄ±rasÄ±nÄ± girin (Ã–rn: kare,Ã¼Ã§gen,yÄ±ldÄ±z,Ã§ember):");
        if (sifre.replace(/ /g, '').toLowerCase() === "kare,Ã¼Ã§gen,yÄ±ldÄ±z,Ã§ember") { cozumTamamla("dolap_kutusu", "Mor SÃ¼mbÃ¼l", "GÃ¼lÃ¼ÅŸÃ¼n, en gri gÃ¼nleri bile aydÄ±nlatan sihirli bir anahtar."); } 
        else { alert("YanlÄ±ÅŸ sembol sÄ±rasÄ±."); }
    }
    else if (nesne_adi === 'yatak' && state.kilitli_nesneler.yatak_kutusu) {
        if (!state.is_mavis_found) {
            alert("Yorgan hareket etti, MaviÅŸ iÃ§eriden kafasÄ±nÄ± Ã§Ä±kardÄ± ve patisiyle yastÄ±ÄŸÄ±n altÄ±nÄ± iÅŸaret etti.");
            state.is_mavis_found = true;
        } else {
            // DÃ¼zeltilmiÅŸ Kedi Åifresi MantÄ±ÄŸÄ±: 48 (FotoÄŸraf) + 11 (Kediler)
            const sifre = prompt("YastÄ±k altÄ±ndaki kutu ÅŸifresini girin (Ä°pucu: FotoÄŸraf (48) ve iki kedi (11)):");
            if (sifre === "4811") { cozumTamamla("yatak_kutusu", "Papatya", "UzaklÄ±k sadece bir mesafe, kalbimiz hep aynÄ± yastÄ±ÄŸa baÅŸ koyuyor."); } 
            else { alert("YanlÄ±ÅŸ ÅŸifre."); }
        }
    }
    else if (nesne_adi === 'koltuk' && state.kilitli_nesneler.koltuk_zarfi) {
        const sifre = prompt("Koltuktaki zarf ÅŸifresini girin (Ä°pucu: Duvar resimleri sÄ±rasÄ± 1, 2, 3):");
        if (sifre === "123") { cozumTamamla("koltuk_zarfi", "MenekÅŸe", "AÅŸk, bir yapboz. Ve sen, eksik kalan en gÃ¼zel parÃ§amsÄ±n."); } 
        else { alert("YanlÄ±ÅŸ ÅŸifre."); }
    }
    else if (nesne_adi === 'duvar_saati' && state.kilitli_nesneler.duvar_saati && state.cicekler.length >= 5) {
        const saat = prompt("Saatin akrep ve yelkovanÄ±nÄ± hangi saate ayarlayacaksÄ±n? (Ä°pucu: 04:08):");
        if (saat === "04:08") { cozumTamamla("duvar_saati", "Orkide ve final", "Final Notu", false, true); } 
        else { alert("YanlÄ±ÅŸ saat ayarÄ±."); }
    }
    else if (!state.kilitli_nesneler[nesne_adi] || (nesne_adi === 'duvar_saati' && state.cicekler.length < 5)) {
        alert(nesne_adi === 'duvar_saati' ? "Ã–nce tÃ¼m ana bulmacalarÄ± Ã§Ã¶zmelisin!" : "Bu bulmaca zaten Ã§Ã¶zÃ¼ldÃ¼.");
    }
    else {
        alert("Bu alanda ÅŸu an bir bulmaca yok.");
    }
}

document.addEventListener('DOMContentLoaded', updateUI);
